<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Member Page</title>
  <script>
    async function fetchMembers() {
      const response = await fetch('/api/members');
      const members = await response.json();
      const membersTable = document.getElementById('members-table-body');
      membersTable.innerHTML = ''; // Clear existing rows
      members.forEach(member => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${member.id}</td>
          <td>${member.prenom}</td>
          <td>${member.nom}</td>
          <td>${member.genre}</td>
          <td>${member.age}</td>
          <td>${member.rang}</td>
          <td><button onclick="deleteMember(${member.id})">Supprimer</button></td>
          <td><button onclick="editMember(${member.id}, '${member.prenom}', '${member.nom}', '${member.genre}', '${member.age}', '${member.date_naissance}')">Modifier</button></td>
        `;
        membersTable.appendChild(row);
      });
    }

    function showForm() {
      document.getElementById('member-form').style.display = 'block';
    }

    function editMember(id, prenom, nom, genre, age, dateNaissance) {
      // Fill the form with the selected member's data
      document.getElementById('member-id').value = id;
      document.getElementById('firstname').value = prenom;
      document.getElementById('lastname').value = nom;
      document.getElementById('gender').value = genre;
      document.getElementById('birthdate').value = dateNaissance;
      // Show the form
      document.getElementById('member-form').style.display = 'block';
      // Update form title
      document.getElementById('form-title').textContent = 'Modifier un membre';
    }

    async function addOrUpdateMember(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData.entries());
      const memberId = data.id;
      
      let response;
      if (memberId) {
        // If there's an ID, update the member
        response = await fetch(`/api/members/${memberId}`, {
          method: 'PUT', // Send PUT request to update
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
      } else {
        // If no ID, add a new member
        response = await fetch('/api/members', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
      }

      if (response.ok) {
        await fetchMembers();
        event.target.reset();
        document.getElementById('member-form').style.display = 'none';
      } else {
        alert('Error adding/updating member');
      }
    }

    async function deleteMember(id) {
      const confirmation = confirm('Are you sure you want to delete this member?');
      if (confirmation) {
        const response = await fetch(`/api/members/${id}`, {
          method: 'DELETE'
        });
        if (response.ok) {
          fetchMembers();
        } else {
          alert('Error deleting member');
        }
      }
    }

    window.onload = fetchMembers;
  </script>
</head>
<body>
  <button onclick="window.location.href='/'">Accueil</button>
  <h1>Bienvenue sur la page des membres !</h1>
  <button onclick="showForm()">Ajouter un membre</button>
  <form id="member-form" style="display:none;" onsubmit="addOrUpdateMember(event)">
    <h3 id="form-title">Ajouter un membre</h3>
    <input type="hidden" id="member-id" name="id">
    <label for="firstname">Prénom:</label>
    <input type="text" id="firstname" name="firstname" required><br>
    <label for="lastname">Nom:</label>
    <input type="text" id="lastname" name="lastname" required><br>
    <label for="gender">Genre:</label>
    <select id="gender" name="gender" required>
      <option value="homme">Homme</option>
      <option value="femme">Femme</option>
    </select>
    <br>
    <label for="birthdate">Date de naissance:</label>
    <input type="date" id="birthdate" name="birthdate" required><br>
    <button type="submit">Ajouter / Modifier</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Prénom</th>
        <th>Nom</th>
        <th>Genre</th>
        <th>Âge</th>
        <th>Rang</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="members-table-body">
      <!-- Members will be populated here -->
    </tbody>
  </table>
</body>
</html>